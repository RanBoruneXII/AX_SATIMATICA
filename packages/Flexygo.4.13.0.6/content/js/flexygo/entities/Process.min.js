var flexygo;!function(flexygo){flexygo.Process=class{constructor(processName,objectName,objectWhere){this.objectName=null,this.objectWhere=null,this.processName=null,this.module=null,this.config=null,this.showProgress=!0,this.moreProcesses=!1,this.processName=processName,this.objectName=objectName,this.objectWhere=objectWhere}read(){let ret=!1,params={ProcessName:this.processName};return flexygo.ajax.syncPost("~/api/Process","getProcessInfoByName",params,response=>{this.config=response,ret=!0}),ret}run(processparams,cllback,targetid,excludeHist=!0,triggerElement){var params={ProcessName:this.processName,ObjectName:this.objectName,ObjectWhere:this.objectWhere,ProcessParams:processparams};cllback||(cllback=(response=>{if(response){if(this.moreProcesses=response.MoreProcesses,response.Refresh&&triggerElement){let cnt=triggerElement.closest(".pageContainer"),parent=cnt.data("opener"),modCol=null;(modCol=parent||cnt).find("flx-module").each((i,e)=>{let wc=$(e)[0];wc.refresh&&wc.refresh()})}if(response.JSCode){var func=new Function("processname","objectname","objectwhere","targetid","excludeHist","triggerElement","currentProcess",response.JSCode);let el=this;triggerElement&&triggerElement[0]&&(el=triggerElement[0]),func.call(triggerElement[0],this.processName,this.objectName,this.objectWhere,targetid,excludeHist,triggerElement,this)}if(response.MoreProcesses||(response.LastException&&response.LastException.Message?flexygo.msg.error(response.LastException.Message):response.WarningMessage?flexygo.msg.warning(response.WarningMessage):response.SuccessMessage&&flexygo.msg.success(response.SuccessMessage),this.closeLoading()),response.CloseParamWindow&&response.Success&&this.module&&this.module.closeWindow(),response.ClearSelectionBag&&response.Success){let ent=new flexygo.obj.Entity(this.objectName);flexygo.selection.clear(ent.getConfig().ObjectName)}let ev={class:"process",type:"executed",sender:this,masterIdentity:this.processName};flexygo.events.trigger(ev)}})),flexygo.ajax.post("~/api/Process","execProcessByName",params,cllback,null,()=>{this.closeLoading()},()=>{this.showLoading()})}runAsync(processparams,cllback,targetid,excludeHist=!0,triggerElement,jsBeforeExecuted=!1,isBefore=!1){return new Promise((resolve,reject)=>{var params={ProcessName:this.processName,ObjectName:this.objectName,ObjectWhere:this.objectWhere,ProcessParams:processparams,JSBeforeExecuted:jsBeforeExecuted};cllback||(cllback=(response=>{if(response){if(response.Refresh&&triggerElement){let cnt=triggerElement.closest(".pageContainer"),parent=cnt.data("opener"),modCol=null;(modCol=parent||cnt).find("flx-module").each((i,e)=>{let wc=$(e)[0];wc.refresh&&wc.refresh()})}if(response.JSCode){var func=new Function("processname","objectname","objectwhere","targetid","excludeHist","triggerElement","currentProcess",response.JSCode);let el=this;triggerElement&&triggerElement[0]&&(el=triggerElement[0]),func.call(triggerElement[0],this.processName,this.objectName,this.objectWhere,targetid,excludeHist,triggerElement,this)}if(response.MoreProcesses||isBefore||(response.LastException&&response.LastException.Message?flexygo.msg.error(response.LastException.Message):response.WarningMessage?flexygo.msg.warning(response.WarningMessage):response.SuccessMessage&&flexygo.msg.success(response.SuccessMessage),this.closeLoading()),response.CloseParamWindow&&response.Success&&this.module&&this.module.closeWindow(),response.ClearSelectionBag&&response.Success){let ent=new flexygo.obj.Entity(this.objectName);flexygo.selection.clear(ent.getConfig().ObjectName)}let ev={class:"process",type:"executed",sender:this,masterIdentity:this.processName};flexygo.events.trigger(ev)}resolve()})),flexygo.ajax.post("~/api/Process","execProcessByName",params,cllback,null,()=>{this.closeLoading()},()=>{this.showLoading()})})}showLoading(){var title;title=this.config&&this.config.LoadingMessage?this.config.LoadingMessage:flexygo.localization.translate("process.executing"),this.showProgress&&this.config&&[0,1,5,6].includes(this.config.TypeId)&&(this.progressBar=Lobibox.progress({title,closeOnEsc:!1,closeButton:!1,onShow:()=>{this.progressTimer=setInterval(()=>this.moveLoading(),500)}}))}moveLoading(){if(this.progressBar){let actVal=this.progressBar.getProgress();actVal=actVal+1>=100?0:actVal+1,this.progressBar.setProgress(actVal)}}closeLoading(){this.progressBar&&(clearInterval(this.progressTimer),this.progressTimer=null,this.progressBar.destroy(),this.progressBar=null)}}}(flexygo||(flexygo={}));